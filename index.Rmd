---
output: 
  html_document
css: styles.css
---

```{r setup, message = F, warning = F, results = 'hide', echo = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F, echo = F, fig.path = 'figs/', fig.align = 'center')

library(tidyverse)
library(downloadthis)
library(here)
library(shiny)
library(showtext)
library(leaflet)
library(crosstalk) # use v1.1.1 to remove (All) from table filter selection
library(DT)

data(tfwdat)
data(locs)

# get font
font_add_google("Roboto", "roboto")#, regular = 'C:/Windows/Fonts/Roboto.ttf')
fml <- "roboto"

showtext_auto()
showtext_opts(dpi = 500)

source(here('R/funcs.R'))
source(here('R/figs.R'))
```

# {.tabset .tabset-fade .tabset-pills}

Site last updated `r Sys.Date()`

## Locations

The map shows all of the locations with a litter collection device.  Select a site from the table to view the location on the map.  The total events indicates the number of dates when litter and debris were collected and enumerated at a site.  The total lbs shows the total weight of all items collected for all events at a site.  

All litter and debris were sampled using the [ETAP method]((https://www.epa.gov/system/files/documents/2021-09/revised_final_etap_june2021.pdf){target="_blank"}). Litter includes items that can be assigned to an ETAP category and debris includes items without a category (usually large, specific items).  For each site and date, only a subset of litter and debris is categorized if the total amount collected exceeds two bags. ETAP provides an overview of the ratios of each type of material found at a site, whereas the total weight is the weight of all the litter and debris found in the device at the collection date.

```{r}
map_fun(locs, tfwdat)
```

## Summaries {.tabset .tabset-fade}

### Totals

These plots show summaries of the total weight of litter and debris as trash or recyclables that were collected to date for all sites.

```{r}
column(12,
  column(3,
    download_file(
      path = here('figs/totlbs.jpg'),
      output_name = "total-summary",
      output_extension = ".jpg",
      button_label = "Download plot",
      button_type = "warning",
      has_icon = TRUE,
      icon = "fa fa-save"
      )
  )
)
```

```{r, out.width = '80%'}
knitr::include_graphics(here('figs/totlbs.jpg'))
```

```{r}
column(12,
  column(3,
    download_file(
      path = here('figs/totlbscos.jpg'),
      output_name = "total-summary-counties",
      output_extension = ".jpg",
      button_label = "Download plot",
      button_type = "warning",
      has_icon = TRUE,
      icon = "fa fa-save"
      )
  )
)
```

```{r, out.width = '80%'}
knitr::include_graphics(here('figs/totlbscos.jpg'))
```

### Totals by site

This plot shows the type of litter and debris counted at each site and event.  The summaries show the total count divided by the number of events at each site, with colors showing the magnitude. Note that reported counts at a site are from a subset of the total bags collected at a site and date if more than two bags were collected.  The tables provides an overview of the types and not quantities.  

```{r}
column(12,
  column(3,
    download_file(
      path = here('figs/cardplo.jpg'),
      output_name = "inventory",
      output_extension = ".jpg",
      button_label = "Download plot",
      button_type = "warning",
      has_icon = TRUE,
      icon = "fa fa-save"
      )
  )
)
```

```{r}
knitr::include_graphics(here('figs/cardplo.jpg'))
```

## Site data

These tables show the litter and debris collected at a site for a given date.  The first table shows counts by category using the [ETAP method]((https://www.epa.gov/system/files/documents/2021-09/revised_final_etap_june2021.pdf){target="_blank"}) and the second table shows the total pounds by category.  Note that counts in the first table are from a subset of the total bags collected at a site and date if more than two bags were collected, whereas the total weights in the second table include all the litter and debris collected.

```{r}
tab1 <- tfwdat %>%
  unite('sitedate', Site, Date, sep = ' - ') %>%   
  select(sitedate, dataCards) %>% 
  unnest('dataCards') %>% 
  arrange(sitedate, item1, item2, itemcnt) %>%
  select(item1, item2, itemcnt, sitedate)
tab2 <- tfwdat %>% 
  unite('sitedate', Site, Date, sep = ' - ') %>% 
  select(LitterTrashWeightLb, LitterRecyclablesWeightLb, DebrisTrashWeightLb, DebrisRecyclablesWeightLb, sitedate)
totab1 <- SharedData$new(tab1, ~sitedate, group = 'choose site date')
totab2 <- SharedData$new(tab2, ~sitedate, group = 'choose site date')

filter_select(id = "filter1", label = "Select site and date", sharedData = totab1, group = ~sitedate, multiple = F)#,
datatable(totab1, extensions = "Scroller", style = "bootstrap", class = "compact", width="100%", rownames = F, caption = 'Items found', 
            options=list(scrollY=400, scroller=TRUE,
                         columnDefs = list(
                           list(visible = F, targets = 3),
                           list(className = 'dt-left', targets = '_all')
                           )
                         ), 
            colnames = c('Item 1', 'Item 2', 'Count', 'sitedate'))
datatable(totab2, extensions = "Scroller", style = "bootstrap", class = "compact", width="100%", rownames = F, caption = 'Total pounds by category',
          options=list(scrollY=300, scroller=TRUE, dom = 'ltp',
                       columnDefs = list(
                         list(visible = F, targets = 4),
                         list(className = 'dt-left', targets = '_all')
                         )
                       ),
          colnames = c('Litter Trash', 'Litter Recyclables', 'Debris trash', 'Debris Recyclables', 'sitedate')
  )
```

```{js}
function filter_default() {
    document.getElementById("filter1").getElementsByClassName("selectized")[0].selectize.setValue("HC_SB_Cotanchobee - 2021-06-29", false);
}
window.onload = filter_default;
```

<!-- <script type="text/javascript" src="js/iframeResizer.contentWindow.min.js"></script> -->
